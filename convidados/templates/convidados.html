{% extends "base.html" %}

{% block 'body' %}
    <div class="max-w-7xl mx-auto mt-12">
        <div class="mx-auto max-w-2xl text-center">

            <h2 class="text-balance text-4xl font-semibold tracking-tight text-gray-900 sm:text-5xl">Olá, {{convidado.nome_convidado}}</h2>
            
            
            {% if convidado.status == 'AC' %}
                <p class="mt-2 text-lg leading-8 text-gray-600">Confirme sua presença no casamento: 
                    <a href="{% url 'responder_presenca' %}?resposta=C&token={{convidado.token}}" class="text-green-400">confirmar</a>, 
                    <a href="{% url 'responder_presenca' %}?resposta=R&token={{convidado.token}}" class="text-red-400">recusar</a>
                </p>
            {% endif %}
        </div>
        <br>
        <hr class="my-4">

        <div class="grid grid-cols-2 gap-4">
            <div>
                <p class="mt-2 text-lg leading-8 text-gray-600">Escolha o presente para os noivos</p>
                <div class="grid grid-cols-3 mt-4 gap-4">
                    
                    {% for presente in presentes %}
                        <div>
                            {% if presente.foto %}
                            <img class="aspect-[3/2] w-full rounded-2xl object-cover" src="{{presente.foto.url}}" alt="">
                            {% endif %}
                            <h3 class="mt-2 text-lg font-semibold leading-8 text-gray-900">{{presente.nome_presente}}</h3>
                            <p class="text-base leading-7 text-gray-600">Valor px: R$ {{ presente.preco|floatformat:2 }}</p>
                            {% if presente.importancia <= 2 %}
                            <span class="inline-flex items-center rounded-md bg-green-400/10 px-2 py-1 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-400/30">Pouco importante <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 text-green-400">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </span>
                            {% elif presente.importancia < 4 %}
                            <span class="inline-flex items-center rounded-md bg-orange-400/10 px-2 py-1 text-xs font-medium text-orange-400 ring-1 ring-inset ring-orange-400/30">Importante <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 text-orange-400">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </span>
                            {% else %}
                            <span class="inline-flex items-center rounded-md bg-red-400/10 px-2 py-1 text-xs font-medium text-red-400 ring-1 ring-inset ring-red-400/30">Muito importante <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4 text-red-400">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </span>
                            {% endif %}

                            <!-- Botão para abrir o modal -->
                            <button type="button" class="rounded-md block w-full mt-4 bg-indigo-500 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-400 cursor-pointer" data-bs-toggle="modal" data-bs-target="#modal{{ presente.id }}">
                                Reservar
                            </button>

                            <!-- Modal -->
                            <div class="modal fade" id="modal{{ presente.id }}" tabindex="-1" aria-labelledby="modalLabel{{ presente.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="modalLabel{{ presente.id }}">{{ presente.nome_presente }}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p><strong>Valor:</strong> R$ {{ presente.preco|floatformat:2 }}</p>
                                            {% if presente.link_sugestao_compra %}
                                                <p><strong>Sugestão de compra:</strong> <a href="{{ presente.link_sugestao_compra }}" target="_blank" class="text-indigo-600 hover:text-indigo-800">Veja a sugestão</a></p>
                                            {% endif %}
                                            <p><strong>Importância:</strong>
                                                {% if presente.importancia <= 2 %}
                                                    Pouco importante
                                                {% elif presente.importancia < 4 %}
                                                    Importante
                                                {% else %}
                                                    Muito importante
                                                {% endif %}
                                            </p>
                                            {% if presente.link_sugestao_compra %}
                                                <p><strong>Presenteie os Noivos com o valor do presente:</strong><a href="{{ presente.link_cobranca }}" target="_blank" class="text-indigo-600 hover:text-indigo-800 btn btn-light shadow">Enviar o valor</a></p>
                                            {% endif %}
                                        </div>
                                        <div class="modal-footer">
                                            <form action="" method="POST">
                                                {% csrf_token %}
                                                
                                                <button type="submit" class="btn btn-primary">Confirmar Reserva</button>
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                            </form>
                                        </div>
                                    </div>
                                </div> 
                            </div>         

                            
                            
                        </div>

                    {% endfor %}
                    
        
                </div>
            </div>

            {% if convidado.maximo_acompanhantes > 0 %}
            <div class="bg-slate-200/20 p-6 rounded-md drop-shadow-lg ring-1 ring-gray-600/20">
                <h2 class="text-xl font-semibold tracking-tight text-gray-900 text-center">Adicione seus acompanhantes</h2>
                
                {% if acompanhantes_restantes > 0 %}
                    <form action="{% url 'adicionar_acompanhante' convidado.token %}" method="POST">
                        {% csrf_token %}
                        <label class="mt-4 block text-sm leading-6 text-gray-900">Nome</label>
                        <input type="text" name="nome" class="block w-full rounded-md border-0 px-3.5 py-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        <input type="submit" class="rounded-md mt-4 bg-indigo-500 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-400 cursor-pointer" value="Adicionar">
                    </form>
                    <p class="text-gray-600 mt-2">Você ainda pode adicionar <strong>{{ acompanhantes_restantes }}</strong> acompanhante(s).</p>
                {% else %}
                    <p class="text-red-500 mt-2">Você já atingiu o número máximo de acompanhantes permitidos.</p>
                {% endif %}

                <hr class="my-4">
                <ul>
                    {% for acompanhante in convidado.acompanhantes.all %}
                        <li class="bg-slate-100 p-4 flex justify-between items-center">
                            {{ acompanhante.nome }}
                            <form action="{% url 'excluir_acompanhante' convidado.token acompanhante.id %}" method="POST" class="inline">
                                {% csrf_token %}
                                <button type="submit" class="text-red-500 hover:text-red-700 text-sm font-semibold">Excluir</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    
        </div>
        
        
        
    </div>
       
{% endblock %}